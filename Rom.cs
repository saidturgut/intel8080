namespace intel8080;

public class Rom
{
    public const byte JUMP = 0xFA;
    private const byte BIOS = 0xFB;
    public const byte DPHB = 0xFC;
    
    public const byte CCPB = 0xE4;
    private const byte BDOS = 0xEC;
    
    private const byte WARM = 0x08;
    
    private static readonly byte[] BIOS_VECTORS =
    [
        0xC3, WARM, BIOS, 0x00, 0x00,
        0xC3, 0x06, BDOS, 0x00, 0x00,
    ];
    
    private static readonly byte[] BIOS_JUMP_TABLE =
    [
        0xC3, 0x00, BIOS, // 00 BOOT
        0xC3, WARM, BIOS, // 01 WBOOT
        
        0xC3, 0x10, BIOS, // 02 CONST
        0xC3, 0x18, BIOS, // 03 CONIN
        0xC3, 0x20, BIOS, // 04 CONOUT
        
        0xC3, 0x28, BIOS, // 05 LIST
        0xC3, 0x30, BIOS, // 06 PUNCH
        0xC3, 0x38, BIOS, // 07 READER
        0xC3, 0x40, BIOS, // 08 HOME
        
        0xC3, 0x48, BIOS, // 09 SELDSK
        0xC3, 0x50, BIOS, // 10 SETTRK
        0xC3, 0x58, BIOS, // 11 SETSEC
        0xC3, 0x60, BIOS, // 12 SETDMA
        0xC3, 0x68, BIOS, // 13 READ
        0xC3, 0x70, BIOS, // 14 WRITE
        0xC3, 0x78, BIOS, // 15 LISTST
        0xC3, 0x80, BIOS, // 16 SECTRAN
    ];
    
    private static readonly byte[] BIOS_ROUTINES =
    [
        0xD3, 0x00, 0xC3, WARM, BIOS, 0x00, 0x00, 0x00, // 00 BOOT
        0xD3, 0x01, 0xC3, 0x00, CCPB, 0x00, 0x00, 0x00, // 01 WBOOT
        0xDB, 0x02, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 02 CONST
        0xDB, 0x03, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 03 CONIN
        0xD3, 0x04, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 04 CONOUT
        0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 05 LIST
        0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 06 PUNCH
        0xDB, 0x07, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 07 READER
        0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 08 HOME
        0xDB, 0x09, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 09 SELDSK
        0xD3, 0x0A, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 10 SETTRK
        0xD3, 0x0B, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 11 SETSEC
        0xD3, 0x0C, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 12 SETDMA
        0xDB, 0x0D, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 13 READ
        0xD3, 0x0E, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 14 WRITE
        0xDB, 0x0F, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 15 LISTST
        0xDB, 0x10, 0xC9, 0x00, 0x00, 0x00, 0x00, 0x00, // 16 SECTRAN
    ];
    
    private static readonly byte[] DPH_TABLE =
    [
        0x00, 0x00,   // XLT = 0
        0x00, 0x00,
        0x00, 0x00,
        0x00, 0x00,
        0x00, 0xFA,   // DIRBUF
        0x00, 0xFB,   // DPB
        0x20, 0xFB,   // CHK
        0x40, 0xFB    // ALV
    ];
    
    private readonly byte[] Tester =
    [
        /*0x3C,
        0x00,
        0x00,
        0xC3, 0x08, 0x00,
        0x76,
        0x76,
        0xD7, 0x76, 0x00,
        0x76, 0x76, 0x76, 0x76, 0x76, 
        0x3C,
        0xC9,*/
        0xFE
        ,0x76
    ];

    public void Init(Ram ram)
    {
        //ram.LoadImage(JUMP << 8, Tester);
        //return;
        
        ram.LoadImage(0x0000, BIOS_VECTORS);
        ram.LoadImage(JUMP << 8, BIOS_JUMP_TABLE);
        ram.LoadImage(BIOS << 8, BIOS_ROUTINES);
        ram.LoadImage(DPHB << 8, DPH_TABLE);
    }
}